# Nginx学习

Nginx作为一个轻量级的web服务器，在学习/生产环境中应用广泛，作为前端还是有必要学习一个Nginx的。

### Nginx简单命令

```sh
# 一般在Linux下的配置路径： /usr/local/etc/nginx
# 如果是自编译或者直接下载的二进制包的话则按照自定义的路径查找

# 启动 
nginx -c ./xxx/nginx.conf 
# 重新启动 
nginx -s reload # 无缝重启
# 检查配置是否正确 
nginx -t
```



### Nginx的负载均衡

##### 负载均衡是什么

一种调度策略，采用分布式设计，用于保证一系列服务器负荷度的平衡，防止过载导致响应慢等问题，提高服务的稳定性。

相比于同等性能的单台机器，能有更高的容错率，集群中单台服务器出现故障也不会导致整个集群挂掉

 

##### 两种代理模式

正向代理： 客户端的请求通过中间人进行转发，目标服务器端不知道发出的请求的真正来源 

反向代理： 客户端的请求到达目标服务器后，通过一定规则将该请求转发给其他服务器代为处理，客户端不知道返回响应的真正的来源。

 负载均衡则是利用反向代理的转发请求这一特性，根据一定的算法、规则来实现负荷的合理分配

 

##### 负载均衡的常见算法

1. 轮询

   遍历服务器列表，按照次序每轮选择一台服务器来处理请求。当全部服务器都被调用了之后，重新进行新一轮的遍历。适合服务器性能接近的集群。缺点就是服务器性能不同的集群会容易导致资源分配不合理的问题。

 

2. 加权轮询

   为了避开上面的问题，可以使用加权轮询。在这个算法中，每个服务器都有各自的权重值weight。weight越大则意味着性能越好。来自客户端的请求按照权重值比例进行分配。当一个请求到达时，会优先分配给权重高的服务器

 

3. IP哈希

   按照请求来源的IP地址的哈希值来分配服务器，这种算法可以确保同一个IP的所有请求都由同一台服务器处理。

   一定程度上可以解决集群部署环境下Session不共享的问题。

   实际应用则可以利用这个特性将一部分ip的请求转发到新版本服务的服务器上，来实现灰度发布。

 

4. URL hash

   和ip哈希类似，在这种算法下相同的URL请求会由同一台服务器来处理。。如果存在缓存的话，命中率（效率）一般比较高。

 

5. 最小连接数

   当请求出现时，会优先分配给服务器列表中连接数最少的服务器来处理。也就是指定当前处理的请求数最少的（负载最低的）服务器来处理。